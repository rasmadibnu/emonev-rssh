import{p as M,r as t,_ as P,q as p,t as i,E as D,z as l,y as o,K as r,G as v,B as s,C as u,A as V,x as h,J as d,aO as F,f as I,F as q,R as $,aI as A}from"./index.4ac76403.js";import{Q,b as f}from"./QCard.31d5c3cb.js";import{a as m,Q as E}from"./QTable.d65de6e2.js";import{Q as K}from"./QPage.c0d0babb.js";import{Q as L}from"./QSpace.0923a10c.js";import{Q as j}from"./QSelect.01e4bf9c.js";import{Q as g}from"./QInput.f4474e1e.js";import{Q as U}from"./QCardActions.76c17390.js";import{Q as G}from"./QForm.82767e93.js";import{i as H,h as w,Q as _,j as k}from"./QDialog.2df1b7e0.js";import{Q as J,C as N}from"./ClosePopup.63eeea50.js";import{_ as T}from"./VxIcon.140795fd.js";import{Q as W}from"./QSeparator.d322f4ad.js";import{Q as Y}from"./QTr.4bf21b35.js";import"./QMarkupTable.e7ae0b29.js";import"./use-key-composition.762f81a8.js";import"./uid.9b787859.js";const X=M({name:"TRMenus",props:["props","row","number","number2","indent"],components:{VxIcon:T},setup(){return{expand:t([])}},computed:{childIndent(){return this.indent+"px"}},methods:{toggleExpand(e){this.expand.includes(e)?this.expand.splice(this.expand.indexOf(e),1):this.expand.push(e)},openDialog(e){this.$emit("openDialog",e)},confirmDelete(e){this.$emit("confirmDelete",e)}}}),Z={class:"text-center"},x={class:"text-center"},ee={class:"text-right"};function le(e,n,z,R,S,B){const b=p("VxIcon"),c=p("vx-icon"),C=p("TRMenus",!0);return i(),D(v,null,[l(Y,{props:e.props},{default:o(()=>[l(m,null,{default:o(()=>[r("div",null,[e.number2?(i(),D(v,{key:0},[s(u(e.number2)+".",1)],64)):V("",!0),s(" "+u(e.number+1),1)])]),_:1}),l(m,null,{default:o(()=>[r("div",{style:F({marginLeft:e.childIndent})},[e.row.Childs.length>0?(i(),h(d,{key:0,"no-caps":"",flat:"",dense:"",size:"sm",onClick:n[0]||(n[0]=a=>e.toggleExpand(e.row.ID)),icon:e.expand.includes(e.row.ID)?"add":"remove"},null,8,["icon"])):V("",!0),s(" "+u(e.row.Name),1)],4)]),_:1}),l(m,null,{default:o(()=>[s(u(e.row.Code),1)]),_:1}),l(m,null,{default:o(()=>[s(u(e.row.Url),1)]),_:1}),l(m,null,{default:o(()=>[r("div",Z,[l(b,{iconName:e.row.Icon,size:18},null,8,["iconName"])])]),_:1}),l(m,null,{default:o(()=>[r("div",x,u(e.row.Ord),1)]),_:1}),l(m,null,{default:o(()=>[r("div",ee,[l(d,{flat:"",dense:"",size:"sm",color:"primary"},{default:o(()=>[l(c,{iconName:"More",size:18}),l(H,{"auto-close":"",class:"tw-shadow-none tw-border"},{default:o(()=>[l(J,{style:{"min-width":"100px"}},{default:o(()=>[I((i(),h(_,{clickable:"",class:"text-primary",onClick:n[1]||(n[1]=a=>e.openDialog(e.row))},{default:o(()=>[l(w,{avatar:""},{default:o(()=>[l(c,{iconName:"Edit",size:20})]),_:1}),l(w,null,{default:o(()=>[s("Ubah")]),_:1})]),_:1})),[[$]]),l(W),I((i(),h(_,{clickable:"",class:"text-negative",onClick:n[2]||(n[2]=a=>e.confirmDelete(e.row.ID))},{default:o(()=>[l(w,{avatar:""},{default:o(()=>[l(c,{iconName:"Trash",size:20})]),_:1}),l(w,null,{default:o(()=>[s("Hapus")]),_:1})]),_:1})),[[$]])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1},8,["props"]),e.expand.includes(e.row.ID)?V("",!0):(i(!0),D(v,{key:0},q(e.row.Childs,(a,O)=>(i(),h(C,{key:a.ID,number:O,number2:e.number+1,row:a,indent:e.indent+10,onOpenDialog:e.openDialog,onConfirmDelete:e.confirmDelete},null,8,["number","number2","row","indent","onOpenDialog","onConfirmDelete"]))),128))],64)}var oe=P(X,[["render",le]]);const y={Name:null,Url:null,Icon:null,Code:null,Index:null},ae=M({props:["user"],components:{VxIcon:T,TRMenus:oe},setup(){const e=[{name:"index",label:"#",align:"center"},{name:"Name",label:"Nama",align:"left",field:"Name",sortable:!0},{name:"Kode",label:"Kode",align:"left",field:"Kode",sortable:!0},{name:"Url",label:"URL",align:"left",field:"Url",sortable:!0},{name:"Icon",label:"Icon",align:"left",field:"Icon",sortable:!0},{name:"Urutan",label:"Urutan",align:"center",field:"Ord",sortable:!0},{name:"action",label:"Action",align:"right"}];return{rows:t([]),columns:e,pagination:t({page:1,rowsPerPage:10}),search:t(""),totalPages:t(0),form_dialog:t(!1),confirm:t(!1),is_edit:t(!1),loading:t(!1),id:t(""),form:t(structuredClone(y)),menu_list:t([])}},mounted(){this.getData()},methods:{getData(){this.loading=!0,this.$api.get("/menus").then(e=>{this.rows=e.data.data,this.menu_list=this.rows.filter(n=>n.ParentID==0).map(n=>({value:n.ID,label:n.Name})),this.loading=!1}).catch(e=>{console.log(e),this.loading=!1})},openDialog(e){e?(this.is_edit=!0,this.id=e.ID,e.ParentID||delete e.ParentID,this.form={...e,Index:e.Ord}):(this.form={...y},this.is_edit=!1),this.form_dialog=!0},closeDialog(){this.form={...y},this.form_dialog=!1,this.loading=!1},submit(){this.loading=!0,this.is_edit?this.$api.put("/menus/"+this.id,{...this.form,UpdateBy:this.user.Username}).then(e=>{this.$q.notify({message:"Menu berhasil diubah",color:"positive"}),this.closeDialog(),this.getData()}).catch(e=>{this.closeDialog(),console.log(e)}):this.$api.post("/menus",{...this.form,CreatedBy:this.user.Username}).then(e=>{this.$q.notify({message:"Menu berhasil ditambahkan",color:"positive"}),this.closeDialog(),this.getData()}).catch(e=>{this.closeDialog(),console.log(e)})},confirmDelete(e){this.id=e,this.confirm=!0},deleteData(){this.$api.delete("/menus/"+this.id).then(e=>{this.$q.notify({message:"Menu berhasil dihapus",color:"positive"}),this.getData(),this.confirm=!1}).catch(e=>{console.log(e),this.confirm=!1})}}}),ne=r("div",{class:"tw-text-3xl tw-mb-4"},"Menu",-1),te=r("div",{class:"tw-flex tw-justify-between tw-w-full"},null,-1),se={class:"text-h6"},ie={class:"text-h6 text-negative tw-flex tw-items-center"};function re(e,n,z,R,S,B){const b=p("vx-icon"),c=p("TRMenus"),C=p("VxIcon");return i(),D(v,null,[l(K,{class:"tw-p-6"},{default:o(()=>[ne,l(Q,{flat:""},{default:o(()=>[l(f,{class:"text-primary tw-font-bold"},{default:o(()=>[l(d,{outline:"","no-caps":"",color:"primary",onClick:n[0]||(n[0]=a=>e.openDialog(null))},{default:o(()=>[l(b,{iconName:"AddCircle",class:"tw-mr-2",size:20}),s(" Tambah ")]),_:1})]),_:1}),l(f,{class:"q-pt-none"},{default:o(()=>[l(E,{flat:"",class:"remove-padding-table-top",loading:e.loading,rows:e.rows,columns:e.columns,"row-key":"ID",pagination:{rowsPerPage:10}},{top:o(()=>[te]),body:o(a=>[l(c,{props:a,row:a.row,number:a.rowIndex,indent:10,onOpenDialog:e.openDialog,onConfirmDelete:e.confirmDelete},null,8,["props","row","number","onOpenDialog","onConfirmDelete"])]),_:1},8,["loading","rows","columns"])]),_:1})]),_:1})]),_:1}),l(k,{modelValue:e.form_dialog,"onUpdate:modelValue":n[7]||(n[7]=a=>e.form_dialog=a)},{default:o(()=>[l(Q,{style:{"min-width":"600px"}},{default:o(()=>[l(f,{class:"row items-center"},{default:o(()=>[r("div",se,u(e.is_edit?"Ubah":"Tmabah")+" Menu",1),l(L),I((i(),h(d,{flat:"",round:"",dense:""},{default:o(()=>[l(b,{iconName:"CloseCircle",size:20})]),_:1})),[[N]])]),_:1}),l(G,{onSubmit:A(e.submit,["prevent"])},{default:o(()=>[l(f,{class:"tw-grid tw-grid-cols-6 tw-gap-x-4 tw-gap-y-2"},{default:o(()=>[l(j,{class:"tw-col-span-6",options:e.menu_list,"emit-value":"","map-options":"",clearable:"",modelValue:e.form.ParentID,"onUpdate:modelValue":n[1]||(n[1]=a=>e.form.ParentID=a),modelModifiers:{number:!0},filled:"",label:"Parent",hint:""},null,8,["options","modelValue"]),l(g,{modelValue:e.form.Name,"onUpdate:modelValue":n[2]||(n[2]=a=>e.form.Name=a),filled:"",label:"Nama",rules:[a=>!!a||"Field harus diisi"],class:"tw-col-span-2"},null,8,["modelValue","rules"]),l(g,{modelValue:e.form.Code,"onUpdate:modelValue":n[3]||(n[3]=a=>e.form.Code=a),filled:"",label:"Code",class:"tw-col-span-2"},null,8,["modelValue"]),l(g,{modelValue:e.form.Url,"onUpdate:modelValue":n[4]||(n[4]=a=>e.form.Url=a),filled:"",label:"URL",rules:[a=>!!a||"Field harus diisi"],class:"tw-col-span-2"},null,8,["modelValue","rules"]),l(g,{modelValue:e.form.Icon,"onUpdate:modelValue":n[5]||(n[5]=a=>e.form.Icon=a),filled:"",label:"Icon",rules:[a=>!!a||"Field harus diisi"],class:"tw-col-span-3"},null,8,["modelValue","rules"]),l(g,{modelValue:e.form.Index,"onUpdate:modelValue":n[6]||(n[6]=a=>e.form.Index=a),modelModifiers:{number:!0},filled:"",mask:"#","reverse-fill-mask":"",label:"Urutan",rules:[a=>!!a||"Field harus diisi"],class:"tw-col-span-3"},null,8,["modelValue","rules"])]),_:1}),l(U,{align:"right"},{default:o(()=>[l(d,{label:"Batal","no-caps":"",flat:"",onClick:e.closeDialog,color:"negative"},null,8,["onClick"]),l(d,{label:"Simpan",loading:e.loading,type:"submit","no-caps":"",flat:"",color:"primary"},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),l(k,{modelValue:e.confirm,"onUpdate:modelValue":n[8]||(n[8]=a=>e.confirm=a)},{default:o(()=>[l(Q,null,{default:o(()=>[l(f,null,{default:o(()=>[r("div",ie,[l(C,{iconName:"Warning2",class:"tw-mr-2",size:22}),s(" Konfirmasi ")])]),_:1}),l(f,{class:"q-pt-none"},{default:o(()=>[s(" Anda yakin ingin menghapus data ini? ")]),_:1}),l(U,{align:"right"},{default:o(()=>[I(l(d,{flat:"",label:"Cancel","no-caps":""},null,512),[[N]]),l(d,{flat:"",label:"Yes",color:"negative","no-caps":"",onClick:e.deleteData},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var $e=P(ae,[["render",re]]);export{$e as default};
