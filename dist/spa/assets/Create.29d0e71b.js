import{Q as g}from"./uid.13d78311.js";import{Q as h}from"./QSelect.72a6ae4e.js";import{Q as _,b,a as f}from"./QItem.14aec6b1.js";import{Q as D}from"./QSeparator.d97bfa32.js";import{Q as V}from"./QInput.002b6111.js";import{Q as P}from"./QMarkupTable.98dc00fc.js";import{_ as k,p as K,r as u,t as p,x as y,y as s,z as o,B as c,aI as U,K as l,aJ as w,aK as v,C as m,E as Q,F as L,G as C,J as F,aL as R,A as I}from"./index.a7378ebc.js";import{Q as N}from"./QForm.77e94b79.js";import{Q as $}from"./QCard.fe4f9e2d.js";import{Q as q}from"./QPage.ed59f19a.js";import"./use-key-composition.67f8f744.js";import"./QDialog.906167cc.js";const B=K({props:["user"],setup(){return{list_year:u([]),year:u(null),list_regency:u([]),regency:u(null),fields:u([]),loading:u(!1)}},mounted(){this.getYear()},methods:{getYear(){this.loading=!0,this.$api.get("/forms?Limit=-").then(t=>{this.list_year=t.data.data.Rows.map(a=>({label:a.Year,value:a.ID})),this.loading=!1}).catch(t=>{console.log(t)})},filterRegency(t,a){if(t===""){a(()=>{var i;this.list_regency=(i=this.user)==null?void 0:i.Group.Details.map(n=>({label:n.RegencyCity.Name,value:n.RegencyCityID,province:n.RegencyCity.Province.LongName}))});return}a(()=>{var n;const i=t.toLowerCase();this.list_regency=(n=this.user)==null?void 0:n.Group.Details.map(d=>({label:d.RegencyCity.Name,value:d.RegencyCityID,province:d.RegencyCity.Province.LongName})).filter(d=>d.label.toLowerCase().indexOf(i)>-1)})},getForm(t){this.loading=!0;const a=this.list_year.find(i=>i.value==t).label;this.$api.get("/forms/"+a+'?Relation={"Name": "Fields"}').then(i=>(this.fields=i.data.data.Fields,this.loading=!1,i)).then(i=>{this.$refs.myForm.resetValidation()}).catch(i=>{console.log(i)})},submit(){this.loading=!0;const t={FormID:this.year,UserID:this.user.ID,RegencyCityID:this.regency,FieldResponse:this.fields.map(a=>({FieldID:a.ID,Value:a.Value}))};this.$api.post("form-responses",t).then(a=>{this.$q.notify({message:"Data berhasil tersimpan",color:"positive"}),this.getForm(this.year)}).catch(a=>{console.log(a)})}}}),S=l("div",{class:"tw-text-3xl tw-mb-4"},"Buat Penginputan",-1),T={class:"q-tr--no-hover"},A=l("td",null,[l("div",{class:""},"-")],-1),z=l("td",null,[l("div",{class:""},"Pilih Tahun Anggaran")],-1),G={class:"md:tw-block tw-hidden"},Y={class:"tw-table-row md:tw-hidden"},E={colspan:"100%"},J={class:"q-tr--no-hover"},M=l("td",null,"-",-1),j=l("td",null,"Pilih Kabupaten Kota",-1),O={class:"md:tw-block tw-hidden"},H={class:"tw-table-row md:tw-hidden"},W={colspan:"100%"},X={class:"q-tr--no-hover"},Z={colspan:"100%"},x={class:"q-tr--no-hover"},ee={class:"md:tw-block tw-hidden"},te={class:"tw-table-row md:tw-hidden"},le={colspan:"100%"},ae={class:"tw-flex tw-justify-center tw-mt-4 tw-gap-4"};function oe(t,a,i,n,d,se){return p(),y(q,{class:"tw-p-6"},{default:s(()=>[S,o($,{flat:""},{default:s(()=>[o(g,{class:"text-primary tw-font-bold"},{default:s(()=>[c(" Anggaran APBD Kab/Kota ")]),_:1}),o(g,{class:"q-pt-none"},{default:s(()=>[o(N,{onSubmit:U(t.submit,["prevent"]),ref:"myForm"},{default:s(()=>[o(P,{flat:"",separator:"none",class:"tw-h-auto"},{default:s(()=>[l("tbody",null,[l("tr",T,[A,z,l("td",G,[o(h,{dense:"",filled:"",modelValue:t.year,"onUpdate:modelValue":[a[0]||(a[0]=e=>t.year=e),t.getForm],label:"Pilih Tahun",options:t.list_year,"map-options":"","emit-value":"",rules:[e=>!!e]},null,8,["modelValue","options","onUpdate:modelValue","rules"])])]),l("tr",Y,[l("td",E,[o(h,{dense:"",filled:"",modelValue:t.year,"onUpdate:modelValue":[a[1]||(a[1]=e=>t.year=e),t.getForm],label:"Pilih Tahun",options:t.list_year,"map-options":"","emit-value":"",rules:[e=>!!e]},null,8,["modelValue","options","onUpdate:modelValue","rules"])])]),l("tr",J,[M,j,l("td",O,[o(h,{dense:"",filled:"",modelValue:t.regency,"onUpdate:modelValue":a[2]||(a[2]=e=>t.regency=e),label:"Pilih Kabupaten Kota",options:t.list_regency,onFilter:t.filterRegency,"use-input":"","map-options":"","emit-value":"",rules:[e=>!!e]},{option:s(e=>[o(_,w(v(e.itemProps)),{default:s(()=>[o(b,null,{default:s(()=>[o(f,null,{default:s(()=>[c(m(e.opt.label),1)]),_:2},1024),o(f,{caption:""},{default:s(()=>[c(m(e.opt.province),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter","rules"])])]),l("tr",H,[l("td",W,[o(h,{dense:"",filled:"",modelValue:t.regency,"onUpdate:modelValue":a[3]||(a[3]=e=>t.regency=e),label:"Pilih Kabupaten Kota",options:t.list_regency,onFilter:t.filterRegency,"use-input":"","map-options":"","emit-value":"",rules:[e=>!!e]},{option:s(e=>[o(_,w(v(e.itemProps)),{default:s(()=>[o(b,null,{default:s(()=>[o(f,null,{default:s(()=>[c(m(e.opt.label),1)]),_:2},1024),o(f,{caption:""},{default:s(()=>[c(m(e.opt.province),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter","rules"])])]),l("tr",X,[l("td",Z,[o(D,{class:"tw-w-full"})])]),(p(!0),Q(C,null,L(t.fields,e=>(p(),Q(C,{key:e.ID},[l("tr",x,[l("td",{class:R(e.class)},m(e.Code),3),l("td",{class:R(e.class)},m(e.Label),3),l("td",ee,[e.Type=="currency"?(p(),y(V,{key:0,dense:"",filled:"",mask:"###,###,###,###,###,###,###,###,###,###","reverse-fill-mask":"",prefix:"Rp",modelValue:e.Value,"onUpdate:modelValue":r=>e.Value=r,rules:[r=>!!r&&e.IsRequired]},null,8,["modelValue","onUpdate:modelValue","rules"])):I("",!0)])]),l("tr",te,[l("td",le,[e.Type=="currency"?(p(),y(V,{key:0,dense:"",filled:"",mask:"###,###,###,###,###,###,###,###,###,###","reverse-fill-mask":"",prefix:"Rp",modelValue:e.Value,"onUpdate:modelValue":r=>e.Value=r,rules:[r=>!!r&&e.IsRequired]},null,8,["modelValue","onUpdate:modelValue","rules"])):I("",!0)])])],64))),128))])]),_:1}),l("div",ae,[o(F,{outline:"",color:"primary",unelevated:"",label:"Kembali",to:{name:"penginputan-index"},"no-caps":"",loading:t.loading},null,8,["loading"]),o(F,{type:"submit",color:"primary",unelevated:"",label:"Simpan","no-caps":"",loading:t.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})}var _e=k(B,[["render",oe]]);export{_e as default};
