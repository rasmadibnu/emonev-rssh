import{_ as z,p as E,r as t,q as N,t as d,E as B,z as l,y as o,G as M,J as r,B as n,C as c,f,x as m,K as g,ct as T,b5 as G,bx as L,A,R as V}from"./index.8d3bc41d.js";import{Q as y,c as u}from"./uid.a7c9062b.js";import{Q}from"./QTd.2af4f5ff.js";import{k as C,j,i as p,g as _,Q as I,h as $}from"./QDialog.91aef4fa.js";import{Q as K}from"./QList.7d314f4b.js";import{Q as q}from"./QTable.22d0512f.js";import{Q as H}from"./QPage.b0d4bf6a.js";import{Q as F}from"./QSpace.1254e4c9.js";import{Q as D}from"./QCardActions.3bdf8b99.js";import{Q as w}from"./QInput.154ed7ac.js";import{Q as J}from"./QMarkupTable.16a70399.js";import{Q as O}from"./QForm.5efdbd7e.js";import{C as P}from"./ClosePopup.b76216ee.js";import{_ as W}from"./VxIcon.7d4dbb07.js";const R={Username:null,GroupID:null,Name:null,Email:null,Password:null,ConfirmPassword:null},Y=E({props:["user"],components:{VxIcon:W},setup(){const e=[{name:"index",label:"#",align:"center"},{name:"Name",label:"Nama",align:"left",field:"Name",sortable:!0},{name:"Username",label:"ID Pengguna",align:"left",field:"Username",sortable:!0},{name:"Email",label:"E-Mail",align:"left",field:"Email",sortable:!0},{name:"action",label:"Action",align:"right"}],s=[{name:"Name",label:"Role",align:"left",field:"Name",sortable:!0}];return{rows:t([]),columns:e,pagination:t({page:1,rowsPerPage:10}),search:t(""),totalPages:t(0),form_dialog:t(!1),confirm:t(!1),is_edit:t(!1),loading:t(!1),id:t(""),form:t(structuredClone(R)),list_group:t([]),role_dialog:t(!1),columns_roles:s,roles:t([]),role_selected:t([])}},mounted(){this.$refs.tableRef.requestServerInteraction(),this.getGroup(),this.getRole()},methods:{getData(e){this.loading=!0,this.pagination=e==null?void 0:e.pagination;const s=new URLSearchParams,U={params:s};let{page:b,rowsPerPage:v,rowsNumber:k}=e.pagination;v==0&&(b=1,v=k),this.totalPages<b&&(b=this.totalPages),s.append("Limit",v),s.append("Page",b),s.append("Relations",'{"Name": "Roles.Menus"}'),this.$api.get("/users",U).then(i=>{this.rows=i.data.data.Rows,this.pagination.rowsNumber=i.data.data.TotalRows,this.totalPages=i.data.data.TotalPages,this.loading=!1}).catch(i=>{console.log(i),this.loading=!1})},getGroup(){this.$api.get('/groups?Limit=-&Relation={"Name": "Details.RegencyCity.Province"}').then(e=>{this.list_group=e.data.data.Rows.map(s=>({value:s.ID,label:s.Name,details:s.Details}))}).catch(e=>{console.log(e)})},getRole(){return this.$api.get('/roles?Limit-&Relations={"Name": "Menus"}').then(e=>{this.roles=e.data.data.Rows}).catch(e=>{console.log(e)})},openFormDialog(e){e?(this.is_edit=!0,this.id=e.ID,delete e.Password,this.form={...e}):(this.form={...R},this.is_edit=!1),this.form_dialog=!0},closeFormDialog(){this.form={...R},this.form_dialog=!1,this.loading=!1},submit(){this.loading=!0,this.is_edit?this.$api.put("/users/"+this.id,{...this.form,UpdateBy:this.user.Username}).then(e=>{this.$q.notify({message:"User berhasil diubah",color:"positive"}),this.closeFormDialog(),this.$refs.tableRef.requestServerInteraction()}).catch(e=>{this.closeFormDialog(),console.log(e)}):this.$api.post("/auth/register",{...this.form,CreatedBy:this.user.Username}).then(e=>{this.$q.notify({message:"User berhasil ditambahkan",color:"positive"}),this.closeFormDialog(),this.$refs.tableRef.requestServerInteraction()}).catch(e=>{this.closeFormDialog(),console.log(e)})},confirmDelete(e){this.id=e,this.confirm=!0},deleteData(){this.$api.delete("/users/"+this.id).then(e=>{this.$q.notify({message:"User berhasil dihapus",color:"positive"}),this.$refs.tableRef.requestServerInteraction(),this.confirm=!1}).catch(e=>{console.log(e),this.confirm=!1})},openRoleDialog(e){this.id=e.ID,delete e.Password,this.form={...e},this.role_selected=[],this.role_selected=e.Roles,this.role_dialog=!0},assignRole(){this.$api.post("users/roles/assign",{Roles:this.role_selected.map(e=>({UserID:this.id,RoleID:e.ID}))}).then(e=>{this.$q.notify({message:"Role berhasil ditambahkan",color:"positive"}),this.$refs.tableRef.requestServerInteraction(),this.role_dialog=!1})}}}),X=g("div",{class:"tw-text-3xl tw-mb-4"},"Pengguna",-1),Z=g("div",{class:"tw-flex tw-justify-between tw-w-full"},null,-1),x=g("div",{class:"text-h6"},"Role",-1),ee={class:"tw-text-lg tw-mb-4"},le={class:"tw-font-semibold"},ae={class:"text-h6"},oe={class:"text-h6 text-negative tw-flex tw-items-center"};function se(e,s,U,b,v,k){const i=N("vx-icon"),S=N("VxIcon");return d(),B(M,null,[l(H,{class:"tw-p-6"},{default:o(()=>[X,l(y,{flat:""},{default:o(()=>[l(u,{class:"tw-flex tw-justify-between tw-items-center"},{default:o(()=>[l(r,{outline:"","no-caps":"",color:"primary",onClick:s[0]||(s[0]=a=>e.openFormDialog(null))},{default:o(()=>[l(i,{iconName:"AddCircle",class:"tw-mr-2",size:20}),n(" Tambah ")]),_:1})]),_:1}),l(u,{class:"q-pt-none"},{default:o(()=>[l(q,{flat:"",ref:"tableRef",class:"remove-padding-table-top",loading:e.loading,rows:e.rows,columns:e.columns,onRequest:e.getData,pagination:e.pagination,"onUpdate:pagination":s[1]||(s[1]=a=>e.pagination=a)},{top:o(()=>[Z]),"body-cell-index":o(a=>[l(Q,{props:a},{default:o(()=>[n(c(a.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-action":o(a=>[l(Q,{props:a},{default:o(()=>[l(r,{flat:"",dense:"",size:"sm",color:"primary"},{default:o(()=>[l(i,{iconName:"More",size:18}),l(j,{"auto-close":"",class:"tw-shadow-none tw-border"},{default:o(()=>[l(K,{style:{"min-width":"100px"}},{default:o(()=>[f((d(),m(_,{clickable:"",class:"text-primary",onClick:h=>e.openRoleDialog(a.row)},{default:o(()=>[l(p,{avatar:""},{default:o(()=>[l(i,{iconName:"UserOctagon",size:20})]),_:1}),l(p,null,{default:o(()=>[n("Roles")]),_:1})]),_:2},1032,["onClick"])),[[V]]),l(I),f((d(),m(_,{clickable:"",class:"text-primary",onClick:h=>e.openFormDialog(a.row)},{default:o(()=>[l(p,{avatar:""},{default:o(()=>[l(i,{iconName:"Edit",size:20})]),_:1}),l(p,null,{default:o(()=>[n("Ubah")]),_:1})]),_:2},1032,["onClick"])),[[V]]),l(I),f((d(),m(_,{clickable:"",class:"text-negative",onClick:h=>e.confirmDelete(a.row.ID)},{default:o(()=>[l(p,{avatar:""},{default:o(()=>[l(i,{iconName:"Trash",size:20})]),_:1}),l(p,null,{default:o(()=>[n("Hapus")]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["loading","rows","columns","onRequest","pagination"])]),_:1})]),_:1})]),_:1}),l(C,{modelValue:e.role_dialog,"onUpdate:modelValue":s[3]||(s[3]=a=>e.role_dialog=a)},{default:o(()=>[l(y,{style:{width:"600px"}},{default:o(()=>[l(u,{class:"row items-center"},{default:o(()=>[x,l(F),f((d(),m(r,{flat:"",round:"",dense:""},{default:o(()=>[l(i,{iconName:"CloseCircle",size:20})]),_:1})),[[P]])]),_:1}),l(u,{class:"q-py-none"},{default:o(()=>{var a;return[g("div",ee,[n(" Pengguna: "),g("span",le,c((a=e.form)==null?void 0:a.Name),1)]),l(q,{flat:"",rows:e.roles,columns:e.columns_roles,selected:e.role_selected,"onUpdate:selected":s[2]||(s[2]=h=>e.role_selected=h),"row-key":"ID",selection:"multiple"},null,8,["rows","columns","selected"])]}),_:1}),l(D,{align:"right"},{default:o(()=>[f(l(r,{flat:"",label:"Batal",color:"negative","no-caps":""},null,512),[[P]]),l(r,{flat:"",label:"Tambah","no-caps":"",onClick:e.assignRole},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(C,{modelValue:e.form_dialog,"onUpdate:modelValue":s[11]||(s[11]=a=>e.form_dialog=a)},{default:o(()=>[l(y,{style:{width:"600px"}},{default:o(()=>[l(u,{class:"row items-center"},{default:o(()=>[g("div",ae,c(e.is_edit?"Ubah":"Tambah")+" Pengguna",1),l(F),f((d(),m(r,{flat:"",round:"",dense:""},{default:o(()=>[l(i,{iconName:"CloseCircle",size:20})]),_:1})),[[P]])]),_:1}),l(O,{onSubmit:T(e.submit,["prevent"])},{default:o(()=>[l(u,{class:"tw-grid md:tw-grid-cols-2 tw-grid-cols-1 tw-gap-x-4 tw-gap-y-2"},{default:o(()=>[l(w,{modelValue:e.form.Username,"onUpdate:modelValue":s[4]||(s[4]=a=>e.form.Username=a),filled:"",label:"ID Pengguna",rules:[a=>!!a||"Field harus diisi"]},null,8,["modelValue","rules"]),l(w,{modelValue:e.form.Name,"onUpdate:modelValue":s[5]||(s[5]=a=>e.form.Name=a),filled:"",label:"Nama",rules:[a=>!!a||"Field harus diisi"]},null,8,["modelValue","rules"]),l(w,{modelValue:e.form.Email,"onUpdate:modelValue":s[6]||(s[6]=a=>e.form.Email=a),filled:"",label:"E-Mail",rules:[a=>!!a||"Field harus diisi",a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)||"E-Mail tidak valid"],"lazy-rules":""},null,8,["modelValue","rules"]),l(J,{filled:"",modelValue:e.form.GroupID,"onUpdate:modelValue":s[7]||(s[7]=a=>e.form.GroupID=a),modelModifiers:{number:!0},options:e.list_group,"map-options":"","emit-value":"",label:"Group",hint:""},{option:o(a=>[l(_,G(L(a.itemProps)),{default:o(()=>[l(p,null,{default:o(()=>[l($,null,{default:o(()=>[n(c(a.opt.label),1)]),_:2},1024),a.opt.details?(d(),m($,{key:0,caption:""},{default:o(()=>[n(c(a.opt.details.map(h=>h.RegencyCity.Name).slice(0,a.opt.details.length>2?2:a.opt.details.length).join(", "))+c(a.opt.details.length>2?"...":""),1)]),_:2},1024)):A("",!0)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),e.is_edit?(d(),m(w,{key:1,modelValue:e.form.Password,"onUpdate:modelValue":s[9]||(s[9]=a=>e.form.Password=a),type:"password",filled:"",label:"Password",hint:""},null,8,["modelValue"])):(d(),m(w,{key:0,modelValue:e.form.Password,"onUpdate:modelValue":s[8]||(s[8]=a=>e.form.Password=a),type:"password",filled:"",label:"Password",rules:[a=>!!a||"Field harus diisi"]},null,8,["modelValue","rules"])),l(w,{modelValue:e.form.ConfirmPassword,"onUpdate:modelValue":s[10]||(s[10]=a=>e.form.ConfirmPassword=a),disable:e.form.Password==null,type:"password",filled:"",label:"Konfirmasi Password",rules:[a=>a===e.form.Password||"Konfirmasi password tidak sama"]},null,8,["modelValue","disable","rules"])]),_:1}),l(D,{align:"right"},{default:o(()=>[l(r,{label:"Batal","no-caps":"",flat:"",onClick:e.closeFormDialog,color:"negative"},null,8,["onClick"]),l(r,{label:"Simpan",loading:e.loading,type:"submit","no-caps":"",flat:"",color:"primary"},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),l(C,{modelValue:e.confirm,"onUpdate:modelValue":s[12]||(s[12]=a=>e.confirm=a)},{default:o(()=>[l(y,null,{default:o(()=>[l(u,null,{default:o(()=>[g("div",oe,[l(S,{iconName:"Warning2",class:"tw-mr-2",size:22}),n(" Konfirmasi ")])]),_:1}),l(u,{class:"q-pt-none"},{default:o(()=>[n(" Anda yakin ingin menghapus data ini? ")]),_:1}),l(D,{align:"right"},{default:o(()=>[f(l(r,{flat:"",label:"Cancel","no-caps":""},null,512),[[P]]),l(r,{flat:"",label:"Yes",color:"negative","no-caps":"",onClick:e.deleteData},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var ve=z(Y,[["render",se]]);export{ve as default};
