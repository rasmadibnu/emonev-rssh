import{c as Ie,r as k,ay as Re,a as x,w as oe,h as g,j as Ae,n as Fe,aB as Me,Q as Ve,k as se,m as de,f as T,v as ze,Z as ce,_ as Pe,p as Be,q as ue,t as I,E as Ee,z as i,y as r,G as Ue,J as _,B as q,C as O,x as A,K as $,ct as Le,R as H}from"./index.b0632e82.js";import{u as je,a as Oe,Q as P,c as S}from"./uid.b2c620fa.js";import{Q as fe}from"./QTd.47292999.js";import{k as G,j as He,i as R,g as J,Q as he}from"./QDialog.a77f7843.js";import{Q as Ge}from"./QList.d4821789.js";import{b as Je,Q as We}from"./QTable.9fa3c3d7.js";import{Q as Ye}from"./QPage.57619862.js";import{Q as me}from"./QSpace.c082cca6.js";import{Q as Ze}from"./QSlideTransition.a7d321d8.js";import{Q as W}from"./QCardActions.fa7e9cf1.js";import{Q as ge}from"./QInput.428ba7f6.js";import{Q as Xe}from"./QForm.6a14a927.js";import{C as B}from"./ClosePopup.c4a6a966.js";import{_ as et}from"./VxIcon.56ff9eff.js";import"./QMarkupTable.1d77c9f6.js";const tt=["none","strict","leaf","leaf-filtered"];var lt=Ie({name:"QTree",props:{...je,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:e=>tt.includes(e)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(e,{slots:s,emit:b}){const{proxy:p}=Ae(),{$q:C}=p,K=Oe(e,C),h=k({}),D=k(e.ticked||[]),d=k(e.expanded||[]);let w={};Re(()=>{w={}});const be=x(()=>`q-tree q-tree--${e.dense===!0?"dense":"standard"}`+(e.noConnectors===!0?" q-tree--no-connectors":"")+(K.value===!0?" q-tree--dark":"")+(e.color!==void 0?` text-${e.color}`:"")),Z=x(()=>e.selected!==void 0),ve=x(()=>e.icon||C.iconSet.tree.icon),X=x(()=>e.controlColor||e.color),F=x(()=>e.textColor!==void 0?` text-${e.textColor}`:""),ke=x(()=>{const l=e.selectedColor||e.color;return l?` text-${l}`:""}),ye=x(()=>e.filterMethod!==void 0?e.filterMethod:(l,a)=>{const t=a.toLowerCase();return l[e.labelKey]&&l[e.labelKey].toLowerCase().indexOf(t)>-1}),y=x(()=>{const l={},a=(t,o)=>{const n=t.tickStrategy||(o?o.tickStrategy:e.tickStrategy),u=t[e.nodeKey],f=t[e.childrenKey]&&Array.isArray(t[e.childrenKey])&&t[e.childrenKey].length!==0,N=t.disabled!==!0&&Z.value===!0&&t.selectable!==!1,v=t.disabled!==!0&&t.expandable!==!1,Ne=n!=="none",z=n==="strict",ne=n==="leaf-filtered",L=n==="leaf"||n==="leaf-filtered";let j=t.disabled!==!0&&t.tickable!==!1;L===!0&&j===!0&&o&&o.tickable!==!0&&(j=!1);let Q=t.lazy;Q===!0&&h.value[u]!==void 0&&Array.isArray(t[e.childrenKey])===!0&&(Q=h.value[u]);const c={key:u,parent:o,isParent:f,lazy:Q,disabled:t.disabled,link:t.disabled!==!0&&(N===!0||v===!0&&(f===!0||Q===!0)),children:[],matchesFilter:e.filter?ye.value(t,e.filter):!0,selected:u===e.selected&&N===!0,selectable:N,expanded:f===!0?d.value.includes(u):!1,expandable:v,noTick:t.noTick===!0||z!==!0&&Q&&Q!=="loaded",tickable:j,tickStrategy:n,hasTicking:Ne,strictTicking:z,leafFilteredTicking:ne,leafTicking:L,ticked:z===!0?D.value.includes(u):f===!0?!1:D.value.includes(u)};if(l[u]=c,f===!0&&(c.children=t[e.childrenKey].map(m=>a(m,c)),e.filter&&(c.matchesFilter!==!0?c.matchesFilter=c.children.some(m=>m.matchesFilter):c.noTick!==!0&&c.disabled!==!0&&c.tickable===!0&&ne===!0&&c.children.every(m=>m.matchesFilter!==!0||m.noTick===!0||m.tickable!==!0)===!0&&(c.tickable=!1)),c.matchesFilter===!0&&(c.noTick!==!0&&z!==!0&&c.children.every(m=>m.noTick)===!0&&(c.noTick=!0),L))){if(c.ticked=!1,c.indeterminate=c.children.some(m=>m.indeterminate===!0),c.tickable=c.tickable===!0&&c.children.some(m=>m.tickable),c.indeterminate!==!0){const m=c.children.reduce((re,Qe)=>Qe.ticked===!0?re+1:re,0);m===c.children.length?c.ticked=!0:m>0&&(c.indeterminate=!0)}c.indeterminate===!0&&(c.indeterminateNextState=c.children.every(m=>m.tickable!==!0||m.ticked!==!0))}return c};return e.nodes.forEach(t=>a(t,null)),l});oe(()=>e.ticked,l=>{D.value=l}),oe(()=>e.expanded,l=>{d.value=l});function M(l){const a=[].reduce,t=(o,n)=>{if(o||!n)return o;if(Array.isArray(n)===!0)return a.call(Object(n),t,o);if(n[e.nodeKey]===l)return n;if(n[e.childrenKey])return t(null,n[e.childrenKey])};return t(null,e.nodes)}function _e(){return D.value.map(l=>M(l))}function pe(){return d.value.map(l=>M(l))}function Ce(l){return l&&y.value[l]?y.value[l].expanded:!1}function we(){e.expanded!==void 0?b("update:expanded",[]):d.value=[]}function ee(){const l=[],a=t=>{t[e.childrenKey]&&t[e.childrenKey].length!==0&&t.expandable!==!1&&t.disabled!==!0&&(l.push(t[e.nodeKey]),t[e.childrenKey].forEach(a))};e.nodes.forEach(a),e.expanded!==void 0?b("update:expanded",l):d.value=l}function E(l,a,t=M(l),o=y.value[l]){if(o.lazy&&o.lazy!=="loaded"){if(o.lazy==="loading")return;h.value[l]="loading",Array.isArray(t[e.childrenKey])!==!0&&(t[e.childrenKey]=[]),b("lazyLoad",{node:t,key:l,done:n=>{h.value[l]="loaded",t[e.childrenKey]=Array.isArray(n)===!0?n:[],Fe(()=>{const u=y.value[l];u&&u.isParent===!0&&te(l,!0)})},fail:()=>{delete h.value[l],t[e.childrenKey].length===0&&delete t[e.childrenKey]}})}else o.isParent===!0&&o.expandable===!0&&te(l,a)}function te(l,a){let t=d.value;const o=e.expanded!==void 0;if(o===!0&&(t=t.slice()),a){if(e.accordion&&y.value[l]){const n=[];y.value[l].parent?y.value[l].parent.children.forEach(u=>{u.key!==l&&u.expandable===!0&&n.push(u.key)}):e.nodes.forEach(u=>{const f=u[e.nodeKey];f!==l&&n.push(f)}),n.length!==0&&(t=t.filter(u=>n.includes(u)===!1))}t=t.concat([l]).filter((n,u,f)=>f.indexOf(n)===u)}else t=t.filter(n=>n!==l);o===!0?b("update:expanded",t):d.value=t}function xe(l){return l&&y.value[l]?y.value[l].ticked:!1}function V(l,a){let t=D.value;const o=e.ticked!==void 0;o===!0&&(t=t.slice()),a?t=t.concat(l).filter((n,u,f)=>f.indexOf(n)===u):t=t.filter(n=>l.includes(n)===!1),o===!0&&b("update:ticked",t)}function qe(l,a,t){const o={tree:p,node:l,key:t,color:e.color,dark:K.value};return ce(o,"expanded",()=>a.expanded,n=>{n!==a.expanded&&E(t,n)}),ce(o,"ticked",()=>a.ticked,n=>{n!==a.ticked&&V([t],n)}),o}function le(l){return(e.filter?l.filter(a=>y.value[a[e.nodeKey]].matchesFilter):l).map(a=>$e(a))}function Se(l){if(l.icon!==void 0)return g(se,{class:"q-tree__icon q-mr-sm",name:l.icon,color:l.iconColor});const a=l.img||l.avatar;if(a)return g("img",{class:`q-tree__${l.img?"img":"avatar"} q-mr-sm`,src:a})}function Te(){b("afterShow")}function De(){b("afterHide")}function $e(l){const a=l[e.nodeKey],t=y.value[a],o=l.header&&s[`header-${l.header}`]||s["default-header"],n=t.isParent===!0?le(l[e.childrenKey]):[],u=n.length!==0||t.lazy&&t.lazy!=="loaded";let f=l.body&&s[`body-${l.body}`]||s["default-body"];const N=o!==void 0||f!==void 0?qe(l,t,a):null;return f!==void 0&&(f=g("div",{class:"q-tree__node-body relative-position"},[g("div",{class:F.value},[f(N)])])),g("div",{key:a,class:`q-tree__node relative-position q-tree__node--${u===!0?"parent":"child"}`},[g("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(t.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(t.selected===!0?" q-tree__node--selected":"")+(t.disabled===!0?" q-tree__node--disabled":""),tabindex:t.link===!0?0:-1,onClick:v=>{ie(l,t,v)},onKeypress(v){Me(v)!==!0&&(v.keyCode===13?ie(l,t,v,!0):v.keyCode===32&&U(l,t,v,!0))}},[g("div",{class:"q-focus-helper",tabindex:-1,ref:v=>{w[t.key]=v}}),t.lazy==="loading"?g(Ve,{class:"q-tree__spinner",color:X.value}):u===!0?g(se,{class:"q-tree__arrow"+(t.expanded===!0?" q-tree__arrow--rotate":""),name:ve.value,onClick(v){U(l,t,v)}}):null,t.hasTicking===!0&&t.noTick!==!0?g(Je,{class:"q-tree__tickbox",modelValue:t.indeterminate===!0?null:t.ticked,color:X.value,dark:K.value,dense:!0,keepColor:!0,disable:t.tickable!==!0,onKeydown:de,"onUpdate:modelValue":v=>{Ke(t,v)}}):null,g("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(t.selected===!0?ke.value:F.value)},[o?o(N):[Se(l),g("div",l[e.labelKey])]])]),u===!0?e.noTransition===!0?g("div",{class:"q-tree__node-collapsible"+F.value,key:`${a}__q`},[f,g("div",{class:"q-tree__children"+(t.disabled===!0?" q-tree__node--disabled":"")},t.expanded?n:null)]):g(Ze,{duration:e.duration,onShow:Te,onHide:De},()=>T(g("div",{class:"q-tree__node-collapsible"+F.value,key:`${a}__q`},[f,g("div",{class:"q-tree__children"+(t.disabled===!0?" q-tree__node--disabled":"")},n)]),[[ze,t.expanded]])):f])}function ae(l){const a=w[l];a&&a.focus()}function ie(l,a,t,o){o!==!0&&a.selectable!==!1&&ae(a.key),Z.value&&a.selectable?e.noSelectionUnset===!1?b("update:selected",a.key!==e.selected?a.key:null):a.key!==e.selected&&b("update:selected",a.key===void 0?null:a.key):U(l,a,t,o),typeof l.handler=="function"&&l.handler(l)}function U(l,a,t,o){t!==void 0&&de(t),o!==!0&&a.selectable!==!1&&ae(a.key),E(a.key,!a.expanded,l,a)}function Ke(l,a){if(l.indeterminate===!0&&(a=l.indeterminateNextState),l.strictTicking)V([l.key],a);else if(l.leafTicking){const t=[],o=n=>{n.isParent?(a!==!0&&n.noTick!==!0&&n.tickable===!0&&t.push(n.key),n.leafTicking===!0&&n.children.forEach(o)):n.noTick!==!0&&n.tickable===!0&&(n.leafFilteredTicking!==!0||n.matchesFilter===!0)&&t.push(n.key)};o(l),V(t,a)}}return e.defaultExpandAll===!0&&ee(),Object.assign(p,{getNodeByKey:M,getTickedNodes:_e,getExpandedNodes:pe,isExpanded:Ce,collapseAll:we,expandAll:ee,setExpanded:E,isTicked:xe,setTicked:V}),()=>{const l=le(e.nodes);return g("div",{class:be.value},l.length===0?e.filter?e.noResultsLabel||C.lang.tree.noResults:e.noNodesLabel||C.lang.tree.noNodes:l)}}});const Y={Name:null,Description:null},at=Be({props:["user"],components:{VxIcon:et},setup(){const e=[{name:"index",label:"#",align:"center"},{name:"Name",label:"Nama",align:"left",field:"Name",sortable:!0},{name:"Deskripsi",label:"Deskripsi",align:"left",field:"Description",sortable:!0},{name:"action",label:"Action",align:"right"}];return{rows:k([]),columns:e,pagination:k({page:1,rowsPerPage:10}),search:k(""),totalPages:k(0),form_dialog:k(!1),confirm:k(!1),is_edit:k(!1),loading:k(!1),id:k(""),form:k(structuredClone(Y)),menu_dialog:k(!1),menus:k([]),menus_ticked:k([])}},mounted(){this.$refs.tableRef.requestServerInteraction(),this.getMenu()},methods:{getData(e){this.loading=!0,this.pagination=e==null?void 0:e.pagination;const s=new URLSearchParams,b={params:s};let{page:p,rowsPerPage:C,rowsNumber:K}=e.pagination;C==0&&(p=1,C=K),this.totalPages<p&&(p=this.totalPages),s.append("Limit",C),s.append("Page",p),s.append("Relations",'{"Name": "Menus.Childs.Childs.Childs.Childs"}'),this.$api.get("/roles",b).then(h=>{this.rows=h.data.data.Rows,this.pagination.rowsNumber=h.data.data.TotalRows,this.totalPages=h.data.data.TotalPages,this.loading=!1}).catch(h=>{console.log(h),this.loading=!1})},getMenu(){return this.$api.get("/menus").then(e=>{this.menus=e.data.data})},openFormDialog(e){e?(this.is_edit=!0,this.id=e.ID,this.form={...e}):(this.form={...Y},this.is_edit=!1),this.form_dialog=!0},closeFormDialog(){this.form={...Y},this.form_dialog=!1,this.loading=!1},submit(){this.loading=!0,this.is_edit?this.$api.put("/roles/"+this.id,{...this.form,UpdateBy:this.user.Username}).then(e=>{this.$q.notify({message:"Role berhasil diubah",color:"positive"}),this.closeFormDialog(),this.$refs.tableRef.requestServerInteraction()}).catch(e=>{this.closeFormDialog(),console.log(e)}):this.$api.post("/roles",{...this.form,CreatedBy:this.user.Username}).then(e=>{this.$q.notify({message:"Role berhasil ditambahkan",color:"positive"}),this.closeFormDialog(),this.$refs.tableRef.requestServerInteraction()}).catch(e=>{this.closeFormDialog(),console.log(e)})},confirmDelete(e){this.id=e,this.confirm=!0},deleteData(){this.$api.delete("/roles/"+this.id).then(e=>{this.$q.notify({message:"Role berhasil dihapus",color:"positive"}),this.$refs.tableRef.requestServerInteraction(),this.confirm=!1}).catch(e=>{console.log(e),this.confirm=!1})},getAllIds(e){let s=[];for(const b of e)s.push(b.ID),b.Childs.length>0&&(s=s.concat(getAllIds(b.Childs)));return s},openMenuDialog(e){this.menus_ticked=[],this.menus_ticked=this.getAllIds(e.Menus),this.id=e.ID,this.form={...e},this.menu_dialog=!0},assignMenu(){this.$api.post("roles/menus/assign",{Menus:this.menus_ticked.map(e=>({RoleID:this.id,MenuID:e}))}).then(e=>{this.$q.notify({message:"Menu berhasil ditambahkan",color:"positive"}),this.$refs.tableRef.requestServerInteraction(),this.menu_dialog=!1})}}}),it=$("div",{class:"tw-text-3xl tw-mb-4"},"Role",-1),nt=$("div",{class:"tw-flex tw-justify-between tw-w-full"},null,-1),rt=$("div",{class:"text-h6"},"Menu",-1),ot={class:"tw-text-lg tw-mb-4"},st={class:"tw-font-semibold"},dt={class:"text-h6"},ct={class:"text-h6 text-negative tw-flex tw-items-center"};function ut(e,s,b,p,C,K){const h=ue("vx-icon"),D=ue("VxIcon");return I(),Ee(Ue,null,[i(Ye,{class:"tw-p-6"},{default:r(()=>[it,i(P,{flat:""},{default:r(()=>[i(S,{class:"text-primary tw-font-bold"},{default:r(()=>[i(_,{outline:"","no-caps":"",color:"primary",onClick:s[0]||(s[0]=d=>e.openFormDialog(null))},{default:r(()=>[i(h,{iconName:"AddCircle",class:"tw-mr-2",size:20}),q(" Tambah ")]),_:1})]),_:1}),i(S,{class:"q-pt-none"},{default:r(()=>[i(We,{flat:"",ref:"tableRef",class:"remove-padding-table-top",loading:e.loading,rows:e.rows,columns:e.columns,onRequest:e.getData,pagination:e.pagination,"onUpdate:pagination":s[1]||(s[1]=d=>e.pagination=d)},{top:r(()=>[nt]),"body-cell-index":r(d=>[i(fe,{props:d},{default:r(()=>[q(O(d.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-action":r(d=>[i(fe,{props:d},{default:r(()=>[i(_,{flat:"",dense:"",size:"sm",color:"primary"},{default:r(()=>[i(h,{iconName:"More",size:18}),i(He,{"auto-close":"",class:"tw-shadow-none tw-border"},{default:r(()=>[i(Ge,{style:{"min-width":"100px"}},{default:r(()=>[T((I(),A(J,{clickable:"",class:"text-primary",onClick:w=>e.openMenuDialog(d.row)},{default:r(()=>[i(R,{avatar:""},{default:r(()=>[i(h,{iconName:"HambergerMenu",size:20})]),_:1}),i(R,null,{default:r(()=>[q("Menu")]),_:1})]),_:2},1032,["onClick"])),[[H]]),i(he),T((I(),A(J,{clickable:"",class:"text-primary",onClick:w=>e.openFormDialog(d.row)},{default:r(()=>[i(R,{avatar:""},{default:r(()=>[i(h,{iconName:"Edit",size:20})]),_:1}),i(R,null,{default:r(()=>[q("Ubah")]),_:1})]),_:2},1032,["onClick"])),[[H]]),i(he),T((I(),A(J,{clickable:"",class:"text-negative",onClick:w=>e.confirmDelete(d.row.ID)},{default:r(()=>[i(R,{avatar:""},{default:r(()=>[i(h,{iconName:"Trash",size:20})]),_:1}),i(R,null,{default:r(()=>[q("Hapus")]),_:1})]),_:2},1032,["onClick"])),[[H]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["loading","rows","columns","onRequest","pagination"])]),_:1})]),_:1})]),_:1}),i(G,{modelValue:e.menu_dialog,"onUpdate:modelValue":s[3]||(s[3]=d=>e.menu_dialog=d)},{default:r(()=>[i(P,{style:{width:"600px"}},{default:r(()=>[i(S,{class:"row items-center"},{default:r(()=>[rt,i(me),T((I(),A(_,{flat:"",round:"",dense:""},{default:r(()=>[i(h,{iconName:"CloseCircle",size:20})]),_:1})),[[B]])]),_:1}),i(S,{class:"q-py-none"},{default:r(()=>{var d;return[$("div",ot,[q(" Role: "),$("span",st,O((d=e.form)==null?void 0:d.Name),1)]),i(lt,{nodes:e.menus,ticked:e.menus_ticked,"onUpdate:ticked":s[2]||(s[2]=w=>e.menus_ticked=w),"node-key":"ID","label-key":"Name","children-key":"Childs","default-expand-all":"",tickStrategy:"leaf"},null,8,["nodes","ticked"])]}),_:1}),i(W,{align:"right"},{default:r(()=>[T(i(_,{flat:"",label:"Batal",color:"negative","no-caps":""},null,512),[[B]]),i(_,{flat:"",label:"Tambah","no-caps":"",onClick:e.assignMenu},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(G,{modelValue:e.form_dialog,"onUpdate:modelValue":s[6]||(s[6]=d=>e.form_dialog=d)},{default:r(()=>[i(P,{style:{width:"600px"}},{default:r(()=>[i(S,{class:"row items-center"},{default:r(()=>[$("div",dt,O(e.is_edit?"Ubah":"Tmabah")+" Role",1),i(me),T((I(),A(_,{flat:"",round:"",dense:""},{default:r(()=>[i(h,{iconName:"CloseCircle",size:20})]),_:1})),[[B]])]),_:1}),i(Xe,{onSubmit:Le(e.submit,["prevent"])},{default:r(()=>[i(S,{class:"tw-space-y-2"},{default:r(()=>[i(ge,{modelValue:e.form.Name,"onUpdate:modelValue":s[4]||(s[4]=d=>e.form.Name=d),filled:"",label:"Nama",rules:[d=>!!d||"Field harus diisi"]},null,8,["modelValue","rules"]),i(ge,{modelValue:e.form.Description,"onUpdate:modelValue":s[5]||(s[5]=d=>e.form.Description=d),filled:"",label:"Deskripsi",type:"textarea"},null,8,["modelValue"])]),_:1}),i(W,{align:"right"},{default:r(()=>[i(_,{label:"Batal","no-caps":"",flat:"",onClick:e.closeFormDialog,color:"negative"},null,8,["onClick"]),i(_,{label:"Simpan",loading:e.loading,type:"submit","no-caps":"",flat:"",color:"primary"},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),i(G,{modelValue:e.confirm,"onUpdate:modelValue":s[7]||(s[7]=d=>e.confirm=d)},{default:r(()=>[i(P,null,{default:r(()=>[i(S,null,{default:r(()=>[$("div",ct,[i(D,{iconName:"Warning2",class:"tw-mr-2",size:22}),q(" Konfirmasi ")])]),_:1}),i(S,{class:"q-pt-none"},{default:r(()=>[q(" Anda yakin ingin menghapus data ini? ")]),_:1}),i(W,{align:"right"},{default:r(()=>[T(i(_,{flat:"",label:"Tidak","no-caps":""},null,512),[[B]]),i(_,{flat:"",label:"Ya",color:"negative","no-caps":"",onClick:e.deleteData},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var Tt=Pe(at,[["render",ut]]);export{Tt as default};
