import{c as g,Q as F}from"./uid.e230f7cc.js";import{Q as p}from"./QSelect.f039e804.js";import{Q as D,h as I,g as y}from"./QDialog.56021862.js";import{Q}from"./QSeparator.833c1549.js";import{Q as _}from"./QInput.67983db4.js";import{Q as C}from"./QMarkupTable.8480e3dd.js";import{_ as $,p as k,r as u,t as m,x as h,y as i,z as l,B as f,ct as P,K as s,b5 as U,bx as N,C as c,E as b,F as q,G as V,J as w,b4 as v,A as R}from"./index.bac37d25.js";import{Q as K}from"./QForm.fab416f0.js";import{Q as L}from"./QPage.85b3fbe9.js";const S=k({props:["user"],setup(){return{list_year:u([]),year:u(null),list_regency:u([]),regency:u(null),fields:u([]),loading:u(!1)}},mounted(){this.getData(),this.getYear()},methods:{getData(){return this.$api.get(`/form-responses/${this.$route.params.id}?Relations={"Name": "FieldResponse.Field"}`).then(e=>{this.year=e.data.data.FormID,this.regency=e.data.data.RegencyCityID,this.$refs.selectRegency.$el.click(),this.fields=e.data.data.FieldResponse.map(a=>({...a.Field,Value:a.Value,ResponseFieldID:a.ID}))}).catch(e=>{console.log(e)})},getYear(){this.loading=!0,this.$api.get("/forms?Limit=-").then(e=>{this.list_year=e.data.data.Rows.map(a=>({label:a.Year,value:a.ID})),this.loading=!1}).catch(e=>{console.log(e)})},filterRegency(e,a){if(e===""){a(()=>{var o;this.list_regency=(o=this.user)==null?void 0:o.Group.Details.map(n=>({label:n.RegencyCity.Name,value:n.RegencyCityID,province:n.RegencyCity.Province.LongName}))});return}a(()=>{var n;const o=e.toLowerCase();this.list_regency=(n=this.user)==null?void 0:n.Group.Details.map(d=>({label:d.RegencyCity.Name,value:d.RegencyCityID,province:d.RegencyCity.Province.LongName})).filter(d=>d.label.toLowerCase().indexOf(o)>-1)})},getForm(e){this.loading=!0;const a=this.list_year.find(o=>o.value==e).label;this.$api.get("/forms/"+a+'?Relation={"Name": "Fields"}').then(o=>(this.fields=o.data.data.Fields,this.loading=!1,o)).then(o=>{this.$refs.myForm.resetValidation()}).catch(o=>{console.log(o)})},submit(){this.loading=!0;const e={FormID:this.year,UserID:this.user.ID,RegencyCityID:this.regency,FieldResponse:this.fields.map(a=>({ID:a.ResponseFieldID,FormResponseID:parseInt(this.$route.params.id),Value:a.Value}))};this.$api.put("form-responses/"+this.$route.params.id,e).then(a=>{this.$q.notify({message:"Data berhasil tersimpan",color:"positive"}),this.loading=!1}).catch(a=>{console.log(a)})}}}),T=s("div",{class:"tw-text-3xl tw-mb-4"},"Edit Penginputan",-1),B={class:"q-tr--no-hover"},A=s("td",null,[s("div",{class:""},"-")],-1),E=s("td",null,[s("div",{class:""},"Pilih Tahun Anggaran")],-1),z={class:"md:tw-block tw-hidden"},G={class:"tw-table-row md:tw-hidden"},Y={colspan:"100%"},j={class:"q-tr--no-hover"},M=s("td",null,"-",-1),J=s("td",null,"Pilih Kabupaten Kota",-1),O={class:"md:tw-block tw-hidden"},H={class:"tw-table-row md:tw-hidden"},W={colspan:"100%"},X={class:"q-tr--no-hover"},Z={colspan:"100%"},x={class:"q-tr--no-hover"},ee={class:"md:tw-block tw-hidden"},te={class:"tw-table-row md:tw-hidden"},ae={colspan:"100%"},se={class:"tw-flex tw-justify-center tw-mt-4 tw-gap-4"};function le(e,a,o,n,d,oe){return m(),h(L,{class:"tw-p-6"},{default:i(()=>[T,l(F,{flat:""},{default:i(()=>[l(g,{class:"text-primary tw-font-bold"},{default:i(()=>[f(" Anggaran APBD Kab/Kota ")]),_:1}),l(g,{class:"q-pt-none"},{default:i(()=>[l(K,{onSubmit:P(e.submit,["prevent"]),ref:"myForm"},{default:i(()=>[l(C,{flat:"",separator:"none",class:"tw-h-auto"},{default:i(()=>[s("tbody",null,[s("tr",B,[A,E,s("td",z,[l(p,{dense:"",filled:"",modelValue:e.year,"onUpdate:modelValue":[a[0]||(a[0]=t=>e.year=t),e.getForm],label:"Pilih Tahun",options:e.list_year,"map-options":"","emit-value":"",rules:[t=>!!t]},null,8,["modelValue","options","onUpdate:modelValue","rules"])])]),s("tr",G,[s("td",Y,[l(p,{dense:"",filled:"",modelValue:e.year,"onUpdate:modelValue":[a[1]||(a[1]=t=>e.year=t),e.getForm],label:"Pilih Tahun",options:e.list_year,"map-options":"","emit-value":"",rules:[t=>!!t]},null,8,["modelValue","options","onUpdate:modelValue","rules"])])]),s("tr",j,[M,J,s("td",O,[l(p,{dense:"",filled:"",ref:"selectRegency",modelValue:e.regency,"onUpdate:modelValue":a[2]||(a[2]=t=>e.regency=t),label:"Pilih Kabupaten Kota",options:e.list_regency,onFilter:e.filterRegency,"use-input":"","map-options":"","emit-value":"",rules:[t=>!!t]},{option:i(t=>[l(D,U(N(t.itemProps)),{default:i(()=>[l(I,null,{default:i(()=>[l(y,null,{default:i(()=>[f(c(t.opt.label),1)]),_:2},1024),l(y,{caption:""},{default:i(()=>[f(c(t.opt.province),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter","rules"])])]),s("tr",H,[s("td",W,[l(p,{dense:"",filled:"",modelValue:e.year,"onUpdate:modelValue":a[3]||(a[3]=t=>e.year=t),label:"Pilih Tahun",options:e.list_year,"map-options":"","emit-value":"",rules:[t=>!!t||"Field ini wajib diisi"]},null,8,["modelValue","options","rules"])])]),s("tr",X,[s("td",Z,[l(Q,{class:"tw-w-full"})])]),(m(!0),b(V,null,q(e.fields,t=>(m(),b(V,{key:t.ID},[s("tr",x,[s("td",{class:v(t.class)},c(t.Code),3),s("td",{class:v(t.class)},c(t.Label),3),s("td",ee,[t.Type=="currency"?(m(),h(_,{key:0,dense:"",filled:"",mask:"###,###,###,###,###,###,###,###,###,###","reverse-fill-mask":"",prefix:"Rp",modelValue:t.Value,"onUpdate:modelValue":r=>t.Value=r,rules:[r=>!!r&&t.IsRequired]},null,8,["modelValue","onUpdate:modelValue","rules"])):R("",!0)])]),s("tr",te,[s("td",ae,[t.Type=="currency"?(m(),h(_,{key:0,dense:"",filled:"",mask:"###,###,###,###,###,###,###,###,###,###","reverse-fill-mask":"",prefix:"Rp",modelValue:t.Value,"onUpdate:modelValue":r=>t.Value=r,rules:[r=>!!r&&t.IsRequired]},null,8,["modelValue","onUpdate:modelValue","rules"])):R("",!0)])])],64))),128))])]),_:1}),s("div",se,[l(w,{outline:"",color:"primary",unelevated:"",label:"Kembali",to:{name:"penginputan-index"},"no-caps":"",loading:e.loading},null,8,["loading"]),l(w,{type:"submit",color:"primary",unelevated:"",label:"Simpan","no-caps":"",loading:e.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})}var fe=$(S,[["render",le]]);export{fe as default};
